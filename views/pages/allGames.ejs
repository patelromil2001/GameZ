<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Catalogue - GameZ</title>
    <link rel="stylesheet" href="/assets/css/allGames.css" />
    <script>
      function handleWishlistClick(button, gameId) {
        fetch(`/add/${gameId}`, {
          method: "POST",
        })
          .then((response) => {
            if (response.ok) {
              button.disabled = true;
              button.textContent = "Added to Wishlist";
              button.classList.add("added-btn");
              alert("Game successfully added to your wishlist!");
            } else {
              throw new Error("Failed to add the game to the wishlist.");
            }
          })
          .catch((error) => {
            console.error(error);
            alert("An error occurred while adding to the wishlist.");
          });
      }
    </script>
  </head>
  <body>
    <div class="page-container">
      <!-- Sidebar -->
      <!-- <aside class="sidebar">
        <h2>Categories</h2>
        <ul>
          <li><a href="/games/all-games?category=action">Action</a></li>
          <li><a href="/games/all-games?category=adventure">Adventure</a></li>
          <li><a href="/games/all-games?category=puzzle">Puzzle</a></li>
          <li><a href="/games/all-games?category=rpg">RPG</a></li>
          <li><a href="/games/all-games?category=shooter">Shooter</a></li>
        </ul>
        <h2>Other Links</h2>
        <ul>
          <li><a href="/wishlist">My Wishlist</a></li>

        </ul>
      </aside> -->

      <div class="catalogue-container">
        <header class="catalogue-header">
          <h1>Games Catalogue</h1>
          <div class="icon">ðŸŽ®</div>

          <form action="/search/results" method="GET" class="search-form">
            <input
              type="text"
              name="query"
              placeholder="Search for games..."
              required
            />
            <button type="submit">Search</button>
          </form>
        </header>

        <section class="games-grid">
          <% if (games && games.length > 0) { %>
            <% games.forEach((game, index) => { %>
              <div class="game-card color-<%= index % 6 %>">
                <a href="/games/game/<%= game._id %>">
                  <img
                    src="<%= game.header_image %>"
                    alt="<%= game.name %>"
                    class="game-image"
                  />
                  <h2 class="game-title"><%= game.name %></h2>
                </a>
                <button
                  onclick="handleWishlistClick(this, '<%= game._id %>')"
                  class="wishlist-btn"
                >
                  Add to Wishlist
                </button>
              </div>
            <% }) %>
          <% } else { %>
            <p>No games found.</p>
          <% } %>
        </section>

        <footer class="pagination">
          <% if (pagination.hasPrev) { %>
            <a href="/games/all-games?page=<%= pagination.currentPage - 1 %>">Prev</a>
          <% } %>
          <% 
             let startPage = Math.max(1, pagination.currentPage - 2);
             let endPage = Math.min(pagination.totalPages, pagination.currentPage + 2);
             if (pagination.currentPage <= 2) { 
               endPage = Math.min(5, pagination.totalPages); 
             } 
             if (pagination.currentPage >= pagination.totalPages - 1) { 
               startPage = Math.max(1, pagination.totalPages - 4); 
             } 
          %>
          <% for (let i = startPage; i <= endPage; i++) { %>
            <a
              href="/games/all-games?page=<%= i %>"
              class="<%= i === pagination.currentPage ? 'active' : '' %>"
            >
              <%= i %>
            </a>
          <% } %>
          <% if (pagination.hasNext) { %>
            <a href="/games/all-games?page=<%= pagination.currentPage + 1 %>">Next</a>
          <% } %>
        </footer>
      </div>
    </div>
  </body>
</html>
